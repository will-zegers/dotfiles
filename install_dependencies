#! /usr/bin/env bash

set -ex

DOTFILES_DIR="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

INSTALL_ALACRITTY=true
while [[ "$#" -gt 0 ]]; do
  case $1 in
    --no-alacritty)
      INSTALL_ALACRITTY=false
      ;;
    *)
      echo "Unknown parameter passed: $1";
      exit 1
  esac
  shift
done

PACKAGES="
  bat
  curl
  gcc
  git
  luarocks
  ripgrep
  sudo
  tmux
  tree
  vim
  wget
  xclip
  zsh
"

if command -v apt; then
  apt update -y
  apt install -y ${PACKAGES}
elif command -v pacman; then
  pacman -Sy
  pacman -S --noconfirm ${PACKAGES}
else
  source /etc/os-release
  echo "Unsupported Linux distro: ${NAME}"
  exit 1
fi

### Grab the latest stable release of Neovim ###
arch=$(uname -m)
if [[ "$arch" == "x86_64" ]]; then
    PKG_NAME="nvim-linux-x86_64"
elif [[ "$arch" == "aarch64" ]]; then
    PKG_NAME="nvim-linux-arm64"
fi

ARCHIVE=${PKG_NAME}.tar.gz
wget https://github.com/neovim/neovim/releases/latest/download/${ARCHIVE} -P /tmp
tar xzf /tmp/${ARCHIVE} -C /usr/local/

ln -sf /usr/local/${PKG_NAME}/bin/nvim /usr/bin/vi
ln -sf /usr/local/${PKG_NAME}/bin/nvim /usr/bin/vim
###

if ! command -v alacritty && ${INSTALL_ALACRITTY}; then
  ${DOTFILES_DIR}/alacritty/install ${DOTFILES_DIR}
fi

touch /tmp/install_dependencies.stamp
