#! /usr/bin/env bash

set -ex

PACKAGES="
  bat
  curl
  gcc
  git
  luarocks
  ripgrep
  sudo
  tmux
  tree
  vim
  wget
  xclip
  zsh
"

if command -v apt; then
  apt update -y
  apt install -y ${PACKAGES}
elif command -v pacman; then
  pacman -Sy
  pacman -S --noconfirm ${PACKAGES}
else
  source /etc/os-release
  echo "Unsupported Linux distro: $NAME"
  exit 1
fi

### Grab the latest stable release of Neovim ###
arch=$(uname -m)
if [[ "$arch" == "x86_64" ]]; then
    PKG_NAME="nvim-linux-x86_64"
elif [[ "$arch" == "aarch64" ]]; then
    PKG_NAME="nvim-linux-arm64"
fi

ARCHIVE=${PKG_NAME}.tar.gz
wget https://github.com/neovim/neovim/releases/latest/download/${ARCHIVE} -P /tmp
tar xzf /tmp/${ARCHIVE} -C /usr/local/

ln -sf /usr/local/${PKG_NAME}/bin/nvim /usr/bin/vi
ln -sf /usr/local/${PKG_NAME}/bin/nvim /usr/bin/vim
###

SCRIPT_DIR="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
if [! command -v alacritty ]; then
  ${SCRIPT_DIR}/alacritty/install
fi

touch /tmp/install_dependencies.stamp
