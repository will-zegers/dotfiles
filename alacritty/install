#! /usr/bin/env bash

set -ex

DEPENDENCIES="
  cargo
  cmake
  git
  libfontconfig1-dev
  libfreetype6-dev
  libxcb-xfixes0-dev
  libxkbcommon-dev
  pkg-config
  python3
  wget
  unzip
"

if command -v apt; then
  apt update
  apt install -y ${DEPENDENCIES}
elif command -v pacman; then
  pacman -Sy
  pacman -S --noconfirm ${DEPENDENCIES}
else
  source /etc/os-release
  echo "Unsupported Linux distro: ${NAME}"
  exit 1
fi

REPO_DIR=/tmp/alacritty
RELEASE=v0.13.2
INSTALL_DIR=/usr/local/bin
CONFIG_DIR=${HOME}/.config/alacritty
THEMES_DIR=${CONFIG_DIR}/themes/

if [ ! -d ${REPO_DIR} ]; then
  git clone -b ${RELEASE} https://github.com/alacritty/alacritty.git ${REPO_DIR}
fi

$(cd ${REPO_DIR}; cargo build --release)

cp ${REPO_DIR}/target/release/alacritty ${INSTALL_DIR}
update-alternatives --install /usr/bin/x-terminal-emulator x-terminal-emulator ${INSTALL_DIR}/alacritty 50
rm -r ${REPO_DIR}

# use Hack Nerd Font for the terminal
FONTS_DIR=/usr/local/share/fonts/
wget "https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/Hack.zip" -O /tmp/Hack.zip
mkdir -p ${FONTS_DIR}
unzip -o /tmp/Hack.zip -d ${FONTS_DIR}
rm -r /tmp/Hack.zip
